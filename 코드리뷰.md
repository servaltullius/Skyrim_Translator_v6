# 코드 리뷰 체크리스트 (Skyrim_Translator_v6 / XTranslatorAi)

이 문서는 이 레포 변경사항을 리뷰할 때 **깨지면 안 되는 번역 파이프라인 규칙**을 중심으로 빠짐/버그/과설계/성능/안정성을 점검하기 위한 체크리스트다.

## 0) 리뷰 범위 확인

- 변경된 파일/영역이 무엇인지 먼저 요약한다 (UI/WPF, Core, tests, tools, Python CLI 등).
- 요청된 범위 밖의 리팩터링/스타일 변경은 지양한다.

## 1) 절대 깨지면 안 되는 규칙 (Critical)

### 1-1. 기본 동작: 번역 캐시 없음

- 기본적으로 매 실행마다 AI 번역은 새로 시작하고, **수동 편집본만 유지**해야 한다.
- 관련 코드: `src/XTranslatorAi.App/ViewModels/MainViewModel.cs` (`ResetNonEditedTranslationsAsync`)

### 1-2. Placeholder / 마크업 보호는 필수

- Creation Kit/Skyrim 런타임 placeholder: `<mag>`, `<dur>`, `<15>` 등은 **원형 그대로 유지**돼야 한다.
- xTranslator/Book 마크업: `[pagebreak]`, `<p ...>`, `<img ...>` 등은 **원형 그대로 유지**돼야 한다.
- 구현 위치:
  - 토큰화/마스킹: `src/XTranslatorAi.Core/Text/PlaceholderMasker.cs`
  - 토큰 검증/복구: `src/XTranslatorAi.Core/Translation/TranslationService.cs`

### 1-3. 토큰 무결성 (Token integrity)

- 출력에는 모든 `__XT_*__` 토큰이 **정확한 개수로 존재**해야 한다.
- 토큰 순서 변경은 원칙적으로 금지하며, 예외적으로 **숫자 의미 placeholder**에 한해 재배치 허용(정책 변경 시 테스트 반드시 추가/수정).
- 이 규칙/정책을 바꿨다면 `tests/XTranslatorAi.Tests`에 테스트 보강이 선행돼야 한다.

### 1-4. 한국어 의미론 (특히 `<mag>/<dur>`)

- 의미:
  - `<mag>` = 수치/양(“magnitude/amount”)
  - `<dur>` = 시간(초) / 지속시간
  - `<15>` = 숫자 수치
- “자동 복구(EnableRepairPass)”는 `<mag>/<dur>` 혼동 및 “시간/수치 뒤바뀜”을 최대한 복구해야 한다.

## 2) 품질 체크리스트 (Major)

- 예외/취소 처리: API 실패, 네트워크 오류, 취소 토큰 등에서 사용자에게 의미 있는 에러가 전달되는가?
- 데이터/성능: 대형 XML 입력에서 O(n^2) 패턴(중첩 루프/반복적인 문자열 연결)이 새로 생기지 않았는가?
- 설계/복잡도: 과도한 추상화/옵션 폭증 없이, 현재 구조(`App`/`Core`/`tools`/`tests`)에 맞게 구현됐는가?
- 긴 함수/파일: 단일 책임이 무너진 긴 메서드가 추가되지 않았는가? (필요 시 분리)

## 3) 검증 방법 (필수 권장)

- 코어 유닛 테스트: `dotnet test tests/XTranslatorAi.Tests/XTranslatorAi.Tests.csproj -c Release`
- 라운드트립 검증:
  - `dotnet run --project tools/XTranslatorAi.Validate -c Release -- input.xml [db.sqlite] [out.xml]`
- (Windows 전용) WPF 빌드/실행:
  - `dotnet build XTranslatorAi.sln -c Release`
  - `dotnet run --project src/XTranslatorAi.App -c Release`

## 4) 리뷰 결과 출력 포맷(권장)

- 변경 요약: 3~5줄
- 이슈 목록(중요도: Critical/Major/Minor):
  - 무엇이 문제인지(현상/리스크)
  - 어디인지(파일 경로/관련 심볼)
  - 권장 수정안(가능하면 구체적으로)
- 결정 필요 사항: 선택지 2~3개 + 트레이드오프

## 5) GitHub PR 작업 시(선택)

- PR 코멘트 처리: `gh-address-comments` 스킬
- CI 실패 분석/수정: `gh-fix-ci` 스킬
